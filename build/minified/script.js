const LocalStorageKey="out_of_memory",Panels={MENU:"menu",HOME:"home",SHOP:"shop",MISSION:"mission",STATS:"stats",DEBRIEF:"debrief",STORY:"story"},Stats={MISSION_WINS:"Missions completed",MISSION_FAILS:"Missions failed",FILES_STOLEN:"Files stolen",SIZE_DL:"Total size downloaded",AVERAGE_RATIO:"Average storage filled",TOTAL_MONEY:"Total money earned"},FileNames={location:["my bedroom","my kitchen","my house","my bathroom","the street","the supermarket","the school","the classroom","the bus","the train","the car"],person:["me","my mother","my father","my daughter","my sister","my son","my brother","my grandma","my grandpa","my uncle","my aunt","my best friend","my SO","my cat","my dog","a friend","Mickael","Jack","Lewis","John","Sam","Anne","Laura","Alice","Marina"],object:["my computer","my keyboard","my kettle","my fork","my sink","my desk","my table","my chair","my bed","my dress","my shirt","my cap","my jacket","an apple","pasta","chocolate","a strawberry","a burger","french fries","lasagna","pizza","salad","a cake","a candy","water","wine","soda","coffee","tea"],animal:["a cat","a dog","a snake","a bird","a butterfly","a horse","a monkey","a dolphin","a tiger","a lion","a bear","an elephant","a wolf","a dear","a spider","a fly","a rat","a mouse"],living:["%person","%animal"],subject:["%person","%object","%animal"],document:["passwords","id card","schedule","[person]'s bank statement","my bank statement","[person]'s bank details","my bank details","mail","vacation","my transcript","[person]'s transcript","shopping list","contacts","[object] invoice"],folder:["paperwork","images","videos","documents","private","temp","recycle bin","desktop","important","work","urgent","backup"],action:["singing","skiing","biking","driving","playing","flying","running","talking","walking","dancing","eating [subject]","drinking [object]","sleeping","working","smashing [object]","building [object]"],sentence:["[living] [action]","[living] [action] in [location]","[living] and [living] [action]"],work:["tutorial for [person]","building [location]","contracts","accounting 101"],code:["index","app","simple_script","ui","test","printer","save","server"],critical:["backups","[person]_backup_full","company_full","it_do_not_leak","StateFiles_SECRET","xxx"]},SizeUnit={O:0,KO:1,MO:2,GO:3,TO:4,PO:5,EO:6,ZO:7,YO:8},FileType={TEXT:0,PICTURE:1,VIDEO:2,FOLDER:3,PROTECTED:4},UpgradeType={STORAGE:0,CONNECTION:1,COMPRESSION:2,ANALYSIS:3,SCRIPTS:4},UpgradeID={STO_FLOPPY:0,STO_SD:1,STO_CD:2,STO_DVD:3,STO_USB:4,STO_HDD:5,STO_SSD:6,STO_NAS:7,CON_MODEM:8,CON_ADSL:9,CON_VDSL:10,CON_FIBER:11,CON_QUANTIC:12,COMP_TXT:13,COMP_PIC:14,COMP_VID:15,ANA_FOLDER_SIZE:16,ANA_SORT_SIZE:17,ANA_VAL_HINT:18,ANA_VAL_ORDER:19,ANA_VAL_EXACT:20,ANA_VAL_FOLDER:21,SCR_HACK_BRUTE:22,SCR_HACK_RAINBOW:23},id=document.getElementById.bind(document),el=document.createElement.bind(document);function rand(a,b){return Math.random()*(b-a)+a}function randInt(a,b){return Math.floor(Math.random()*(b-a)+a)}function randBool(a){return"number"==typeof a?Math.random()<a:.5>Math.random()}function randDate(a,b){const c=a.getTime();return new Date(c+Math.random()*(b.getTime()-c))}function randValue(a){return a[randInt(0,a.length)]}function humanize(a){return a.split(" ").map(a=>a[0].toUpperCase()+a.substr(1,a.length).toLowerCase()).join(" ")}let nodeIdCounter=0;function getNodeId(){return nodeIdCounter++}function randName(){const a=randInt(3,10);let b="";for(let c=0;c<a;c++)b+=String.fromCharCode(randInt(97,122));return b}function randDateFileName(){const a=randDate(new Date(9466848e5),new Date);return a.toLocaleDateString().replace(/(.+)\/(.+)\/(.+)/,"$3-$2-$1")}function getMediaName(){let a=randBool()?randomName("sentence"):randDateFileName();return a=randBool()?a:humanize(a),a}function getSizeValue(a,b,c,d){const e=rand(a,b),f=randInt(c,d)*((e-a)/(b-a)+.5);return{size:e,value:f}}const valueKeywords={id:2,password:10,contact:3,bank:3,contract:4,invoice:4};function keywordMultiplier(a){const b=Object.keys(valueKeywords).find(b=>a.includes(b));return void 0===b?1:valueKeywords[b]}const NodeGenerators={Picture:a=>{const b=getMediaName(),c=getSizeValue(5,15,50,100);return{id:getNodeId(),name:b+`.${randValue(["jpg","png","gif"])}`,size:fileSize(c.size,SizeUnit.MO),type:FileType.PICTURE,value:c.value*a.valueMultiplier*keywordMultiplier(b)}},Video:a=>{const b=getMediaName(),c=getSizeValue(50,1500,100,1e3);return{id:getNodeId(),name:b+`.${randValue(["mp4","avi","mov"])}`,size:fileSize(c.size,SizeUnit.MO),type:FileType.VIDEO,value:c.value*a.valueMultiplier*keywordMultiplier(b)}},WorkVideo:a=>{const b=randomName("work"),c=getSizeValue(1,20,1e3,1e4);return{id:getNodeId(),name:b+`.${randValue(["mp4","avi","mov"])}`,size:fileSize(c.size,SizeUnit.GO),type:FileType.VIDEO,value:c.value*a.valueMultiplier*keywordMultiplier(b)}},Critical:a=>{const b=randomName("critical"),c=getSizeValue(50,1500,1e5,1e6);return randBool(.1)&&(c.value*=10),{id:getNodeId(),name:b+`.${randValue(["db","dat","sql"])}`,size:fileSize(c.size,SizeUnit.GO),type:FileType.PROTECTED,value:c.value*a.valueMultiplier*keywordMultiplier(b)}},Code:a=>{const b=getSizeValue(1,20,1e3,1e4);return randBool(.05)&&(b.value*=10),{id:getNodeId(),name:randomName("code")+`.${randValue(["js","c","cpp","java","dll"])}`,size:fileSize(b.size,SizeUnit.KO),type:FileType.PROTECTED,value:b.value*a.valueMultiplier}},Text:a=>{let b=randBool(.1)?randName():randomName("document");b=randBool(.2)?`${b}_${randValue(["final","tmp","final_final"])}`:b;const c=getSizeValue(10,150,5,20),d=c.value*a.valueMultiplier*keywordMultiplier(b);return{id:getNodeId(),name:b+`.${randValue(["txt","doc","xls","pdf"])}`,size:fileSize(c.size,SizeUnit.KO),type:1e3<d?FileType.PROTECTED:FileType.TEXT,value:d}},Folder:a=>{const b={name:0===a.stack.length?"":randomName("folder"),type:FileType.FOLDER,children:[]};switch(a=Object.assign({},a),a.stack.push(b),b.name){case"work":a.valueMultiplier+=4,a.allowedTypes=["Text","Critical","Code","WorkVideo"];break;case"important":a.valueMultiplier+=1;break;case"urgent":a.valueMultiplier+=2;break;case"paperwork":a.valueMultiplier+=3,a.allowedTypes=["Text","Critical"];break;case"documents":a.allowedTypes=["Text","Code"];break;case"private":a.valueMultiplier+=2,a.allowedTypes=["Text"];break;case"images":a.allowedTypes=["Picture","Video"];break;case"videos":a.allowedTypes=["Picture","Video"];break;case"backup":a.valueMultiplier+=3,a.allowedTypes=["Critical","Code","Text"];}const c=Math.min(a.stack.length,5)-1,d=[4,3,1,0,0][c],e=[6,4,3,2,0][c];let f=0;const g=randInt(10,20);for(let c=0;c<g;c++){const d=generateNode(a,b=>f===e?"Folder"!==b:a.allowedTypes.includes(b)||randBool(.01)),g=void 0!==d.children;if(b.name===d.name||b.children.some(a=>a.name===d.name)){c--;continue}g&&f++,b.children.push(d)}for(let c=f;c<d;c++){const d=generateNode(a,a=>"Folder"===a);if(b.name===d.name||b.children.some(a=>a.name===d.name)){c--;continue}b.children.push(d)}return a.stack.pop(),b}};function fileSize(a,b){let c=a*Math.pow(10,3*b);return Math.max(Math.round(c),0)}function formatFileSize(a){if(0===a)return"0 O";const b=Math.floor(Math.log10(a)/3),c=Object.keys(SizeUnit)[b],d=a/Math.pow(10,3*b);return`${d.toFixed(3)} ${c}`}function generateNode(a,b){let c=Object.keys(NodeGenerators);return void 0!==b&&(c=c.filter(b)),NodeGenerators[randValue(c)](a)}let initialized=!1;function generateFileTree(){initFileNames();const a={stack:[],valueMultiplier:1,allowedTypes:Object.keys(NodeGenerators).filter(a=>!["Critical","Code","WorkVideo"].includes(a))},b=[...NodeGenerators.Folder(a).children];return b}function randomName(a){return genText(randValue(FileNames[a]))}function genText(a){const b=a.replaceAll(/\[([a-z]+)\]/g,(a,b)=>{let c=randValue(FileNames[b]);return c.match(/\[[a-z]+\]/)&&(c=genText(c)),c});return b}function initFileNames(){for(const a in FileNames){const b=[];for(const c of FileNames[a])c.startsWith("%")?b.push(...FileNames[c.substring(1)]):b.push(c);FileNames[a]=b}}const Upgrades=[{name:"Storage",desc:"Increases the maximum of files that you can steal",children:[{id:UpgradeID.STO_FLOPPY,name:"Floppy disk",cost:0,type:UpgradeType.STORAGE,value:fileSize(80,SizeUnit.KO)},{id:UpgradeID.STO_SD,name:"SD Card",cost:100,type:UpgradeType.STORAGE,value:fileSize(1,SizeUnit.MO)},{id:UpgradeID.STO_CD,name:"CD",cost:1e3,type:UpgradeType.STORAGE,value:fileSize(700,SizeUnit.MO)},{id:UpgradeID.STO_DVD,name:"DVD",cost:1e4,type:UpgradeType.STORAGE,value:fileSize(1.46,SizeUnit.GO)},{id:UpgradeID.STO_USB,name:"USB Key",cost:1e5,type:UpgradeType.STORAGE,value:fileSize(8,SizeUnit.GO)},{id:UpgradeID.STO_HDD,name:"HDD",cost:1e6,type:UpgradeType.STORAGE,value:fileSize(128,SizeUnit.GO)},{id:UpgradeID.STO_SSD,name:"SSD",cost:5e6,type:UpgradeType.STORAGE,value:fileSize(512,SizeUnit.GO)},{id:UpgradeID.STO_NAS,name:"NAS",cost:1e7,type:UpgradeType.STORAGE,value:fileSize(4,SizeUnit.TO)}]},{name:"Connection",desc:"Speed up the file transfer",children:[{id:UpgradeID.CON_MODEM,name:"Modem 56k",cost:0,type:UpgradeType.CONNECTION,value:fileSize(56,SizeUnit.KO)},{id:UpgradeID.CON_ADSL,name:"ADSL",cost:2e3,type:UpgradeType.CONNECTION,value:fileSize(1,SizeUnit.MO)},{id:UpgradeID.CON_VDSL,name:"VDSL",cost:2e4,type:UpgradeType.CONNECTION,value:fileSize(100,SizeUnit.MO)},{id:UpgradeID.CON_FIBER,name:"Optic Fiber",cost:2e5,type:UpgradeType.CONNECTION,value:fileSize(1,SizeUnit.GO)},{id:UpgradeID.CON_QUANTIC,name:"Quantic Entanglement",cost:2e6,type:UpgradeType.CONNECTION,value:fileSize(100,SizeUnit.GO)}]},{name:"Compression",desc:"Reduce the size of a file after downloading",children:[{id:UpgradeID.COMP_TXT,name:"Text",desc:"Compress text files by 30% while downloading",cost:2e3,type:UpgradeType.COMPRESSION,value:.7},{id:UpgradeID.COMP_PIC,name:"Picture",desc:"Compress pictures by 20% while downloading",cost:8e3,type:UpgradeType.COMPRESSION,value:.8},{id:UpgradeID.COMP_VID,name:"Video",desc:"Compress videos by 10% while downloading",cost:16e3,type:UpgradeType.COMPRESSION,value:.9}]},{name:"Analysis",children:[{id:UpgradeID.ANA_FOLDER_SIZE,name:"Folder size",desc:"Display the size of folders",cost:5e3,type:UpgradeType.ANALYSIS},{id:UpgradeID.ANA_SORT_SIZE,name:"Sort by size",desc:"Sort files by size",cost:2e3,type:UpgradeType.ANALYSIS},{name:"Value analyzer",desc:"Show information about the file's resell value",children:[{id:UpgradeID.ANA_VAL_HINT,name:"Value hint",desc:"Show a price rating from one to three stars, relative to the current mission",cost:1e4,type:UpgradeType.ANALYSIS},{id:UpgradeID.ANA_VAL_ORDER,name:"Order of magnitude",desc:"Show the order of magnitude of the file's price: \u20AC, k\u20AC, M\u20AC...",cost:1e5,type:UpgradeType.ANALYSIS},{id:UpgradeID.ANA_VAL_EXACT,name:"Exact price",desc:"Show the exact price of the file",cost:1e6,type:UpgradeType.ANALYSIS},{id:UpgradeID.ANA_VAL_FOLDER,name:"Display on folders",desc:"Display the value on folders as well",cost:1e5,type:UpgradeType.ANALYSIS}]}]},{name:"Scripts",children:[{name:"AutoFileDecrypt.sh",desc:"Decrypts a protected file",children:[{id:UpgradeID.SCR_HACK_BRUTE,name:"Bruteforce",desc:"2 KO/s",cost:5e4,type:UpgradeType.SCRIPTS},{id:UpgradeID.SCR_HACK_RAINBOW,name:"Rainbow Tables",desc:"50 GB/s",cost:5e5,type:UpgradeType.SCRIPTS}]}]}],missionView={tree:id("mission-file-tree"),path:id("mission-path"),stolen:id("stolen-files"),time:id("mission-time"),sizeValue:id("mission-space-value"),sizeProgress:id("mission-space-progress"),dlPopup:id("dl-popup"),dlFile:id("dl-file"),dlProgress:id("dl-progress"),dlLabel:id("dl-label")};let currentMission=[];function unStealFile(a,b){currentMission.stolenFiles.splice(currentMission.stolenFiles.indexOf(a),1),currentMission.size.current-=a.size,updateSize(),missionView.stolen.removeChild(b),currentMission.nodeIdToLi[a.id]?.classList.remove("disabled")}function stealFile(a){void 0!==currentMission.dl.node||currentMission.stolenFiles.includes(a)||currentMission.size.current+a.size>currentMission.size.total||(currentMission.dl={node:a},missionView.dlPopup.style.display="block",missionView.dlFile.innerText=a.name,missionView.dlProgress.value=0)}function endDl(){const a=currentMission.dl.node;currentMission.stolenFiles.push(a);let b=a.size;hasUpgrade(UpgradeID.COMP_TXT)&&a.type===FileType.TEXT?b*=idToUpgrade[UpgradeID.COMP_TXT].value:hasUpgrade(UpgradeID.COMP_PIC)&&a.type===FileType.PICTURE?b*=idToUpgrade[UpgradeID.COMP_PIC].value:hasUpgrade(UpgradeID.COMP_VID)&&a.type===FileType.VIDEO&&(b*=idToUpgrade[UpgradeID.COMP_VID].value),currentMission.size.current+=b,currentMission.nodeIdToLi[a.id].classList.add("disabled"),updateSize(),refreshStolen(),cancelDl()}function cancelDl(){currentMission.dl={},missionView.dlPopup.style.display="none"}function refreshStolen(){missionView.stolen.innerText="",currentMission.stolenFiles.sort((c,a)=>c.size<a.size).forEach(b=>{const c=el("li"),d=el("a");d.innerText=b.name+"\n- "+formatFileSize(b.size),d.onclick=()=>unStealFile(b,c),c.append(d),missionView.stolen.append(c)})}function onNodeClicked(a){a.children===void 0?".."===a.name?leaveNode():stealFile(a):enterNode(a)}function sumRecursively(a,b){let d=0;const e=b(a);return void 0!==e&&(d+=e),a.children&&a.children.forEach(a=>d+=sumRecursively(a,b)),d}function createNode(a){const b=el("li");let c=el("a");c.setAttribute("href","#"),c.onclick=function(){onNodeClicked(a)},c.innerText=void 0===a.name?"/":a.name,a.type===FileType.PROTECTED&&(c.innerText+=" \u26BF",!hasUpgrade(UpgradeID.SCR_HACK_BRUTE)&&!hasUpgrade(UpgradeID.SCR_HACK_RAINBOW)&&(c.classList.add("danger"),c.onclick=null));const d=document.createElement("span");if(d.classList.add("li-right"),void 0!==a.value||hasUpgrade(UpgradeID.ANA_VAL_FOLDER)&&".."!==a.name){const b=sumRecursively(a,a=>a.value),c=el("span");if(c.classList.add("file-hint"),hasUpgrade(UpgradeID.ANA_VAL_EXACT))c.innerText=`${b.toFixed(2)}€`;else if(hasUpgrade(UpgradeID.ANA_VAL_ORDER)){const a=Math.min(Math.floor(Math.log10(b)/3),4);c.innerText=["\u20AC","k\u20AC","M\u20AC","B\u20AC"][a]}else if(hasUpgrade(UpgradeID.ANA_VAL_HINT)){const a=Math.floor(100*((b-currentMission.hint.min)/currentMission.hint.range));c.innerText=66<a?"\u2605\u2605\u2605":33<a?"\u2605\u2605":"\u2605"}d.append(c)}if(void 0!==a.size||hasUpgrade(UpgradeID.ANA_FOLDER_SIZE)&&".."!==a.name){const b=el("span");b.classList.add("size-span"),a.size>getMaxStorageUpgrade().value&&b.classList.add("danger"),b.innerText=`${formatFileSize(sumRecursively(a,a=>a.size))}`,d.append(b)}c.append(d);const e=document.createElement("div");return e.classList.add("clear"),c.append(e),void 0===a.children?currentMission.stolenFiles.includes(a)&&b.classList.add("disabled"):b.classList.add("has-children"),b.append(c),b}function nodeSorter(c,a){const b=hasUpgrade(UpgradeID.ANA_SORT_SIZE);return c.children&&a.children?b&&hasUpgrade(UpgradeID.ANA_FOLDER_SIZE)?sumRecursively(c,a=>a.size)<sumRecursively(a,a=>a.size):c.name>a.name:c.children&&!a.children?-1:!c.children&&a.children?1:b?c.size<a.size:c.name>a.name}function enterNode(a){if(currentMission.nodeStack.push(a),currentMission.nodeIdToLi={},updateRemotePath(),missionView.tree.innerText="",1<currentMission.nodeStack.length){const a=createNode({name:".."});a.classList.add("has-children"),missionView.tree.append(a)}for(let b of a.children.sort(nodeSorter)){const a=createNode(b);currentMission.nodeIdToLi[b.id]=a,missionView.tree.append(a)}}function leaveNode(){currentMission.nodeStack.pop(),enterNode(currentMission.nodeStack.pop())}function updateRemotePath(){let a="";for(let b of currentMission.nodeStack)a+=`${b.name??""}/`;missionView.path.innerText=a}function updateSize(){missionView.sizeValue.innerText=`${formatFileSize(currentMission.size.current)} / ${formatFileSize(currentMission.size.total)}`;let a=0;0!==currentMission.size.total&&(a=100*(currentMission.size.current/currentMission.size.total)),currentMission.size.percentage=a,missionView.sizeProgress.value=a,missionView.sizeProgress.className=90<a?"full":70<a?"warning":""}function parseTree(a,b,d){d(a);const e=b(a);Array.isArray(e)&&e.forEach(a=>parseTree(a,b,d))}function startMission(){debriefList.innerText="",currentMission={remoteFiles:{children:generateFileTree()},stolenFiles:[],nodeStack:[],nodeIdToLi:{},time:{available:120000,start:null},size:{total:getMaxStorageUpgrade().value,current:0,percentage:0},dl:{},animationFrameId:requestAnimationFrame(updateMission)},missionView.stolen.innerText="",updateSize(),hasUpgrade(UpgradeID.ANA_VAL_HINT)&&(currentMission.hint={min:1/0,max:-Infinity},parseTree(currentMission.remoteFiles,a=>a.children,a=>{a.value!==void 0&&(currentMission.hint.min=Math.min(currentMission.hint.min,a.value),currentMission.hint.max=Math.max(currentMission.hint.max,a.value))}),currentMission.hint.range=currentMission.hint.max-currentMission.hint.min),enterNode(currentMission.remoteFiles),setPanel(Panels.MISSION)}function updateMission(a){if(void 0===currentMission.time)return;if(null===currentMission.time.start&&(currentMission.time.start=a),a>currentMission.time.start+currentMission.time.available)return void endMission(!1);const b=Math.floor((currentMission.time.start+currentMission.time.available-a)/1e3),c=Math.floor(b/60),d=b%60;if(missionView.time.innerText=`${10>c?`0${c}`:c}:${10>d?`0${d}`:d}`,void 0!==currentMission.dl.node)if(void 0===currentMission.dl.start)currentMission.dl.start=a,currentMission.dl.phase="dl",missionView.dlLabel.innerText="Downloading";else if("dl"===currentMission.dl.phase){const b=(a-currentMission.dl.start)/1e3*getMaxInternetUpgrade().value,c=100*(b/currentMission.dl.node.size);100<=c?currentMission.dl.node.type===FileType.PROTECTED?(currentMission.dl.start=a,currentMission.dl.phase="decrypt",missionView.dlLabel.innerText="Decrypting"):endDl():missionView.dlProgress.value=c}else{const b=hasUpgrade(UpgradeID.SCR_HACK_RAINBOW)?fileSize(50,SizeUnit.GO):fileSize(1,SizeUnit.KO),c=(a-currentMission.dl.start)/1e3*b,d=100*(c/currentMission.dl.node.size);100<=d?endDl():missionView.dlProgress.value=d}currentMission.animationFrameId=requestAnimationFrame(updateMission)}function endMission(a){a=false!==a;const b=currentMission.stolenFiles.length;addDebriefLine(`Number of files stolen: ${b}`),addDebriefLine(`Storage status: ${formatFileSize(currentMission.size.current)} / ${formatFileSize(currentMission.size.total)} - ${currentMission.size.percentage.toFixed(2)}% filled`),addDebriefLine("<hr>");let c=0;for(const b of currentMission.stolenFiles)c+=b.value;addDebriefLine(`&nbsp;&nbsp;${c.toFixed(2)}€ - Total value of all files`);let d=0;90<currentMission.size.percentage?(d+=.2,addDebriefLine("+ 20% - Storage filled more than 90%")):70<currentMission.size.percentage&&(d+=.1,addDebriefLine("+ 10% - Storage filled more than 70%")),a||(d-=.7,addDebriefLine("- 90% - Busted by HADOPI",["danger"]));const e=c*(1+d);state.money+=e,addDebriefLine(`= ${e.toFixed(2)}€`),addDebriefLine("<hr>"),addDebriefLine("File details:"),currentMission.stolenFiles.sort((c,a)=>c.value<a.value).forEach(a=>addDebriefLine(`- ${a.name} - ${a.value.toFixed(2)}€`)),addToStat(a?Stats.MISSION_WINS:Stats.MISSION_FAILS,1),addToStat(Stats.FILES_STOLEN,b),addToStat(Stats.SIZE_DL,currentMission.size.current),addToStat(Stats.TOTAL_MONEY,e);const f=getStat(Stats.MISSION_WINS)+getStat(Stats.MISSION_FAILS),g=currentMission.size.percentage+getStat(Stats.AVERAGE_RATIO)*(f-1);setStat(Stats.AVERAGE_RATIO,g/f),cancelAnimationFrame(currentMission.animationFrameId);currentMission={},save(),setPanel(0<b?Panels.DEBRIEF:Panels.HOME)}const debriefList=id("debrief-list");function addDebriefLine(a,b){const c=el("li");c.innerHTML=a,b&&c.classList.add(...b),debriefList.append(c)}const homeView={upgrades:id("home-upgrades")};function upgradeSorter(c,a){return c.type===a.type?c.value&&a.value?c.value>a.value:c.name>a.name:c.type>a.type}function onHomePanel(){updateMoney(),homeView.upgrades.innerText="";let a;for(const b of state.upgrades.map(a=>idToUpgrade[a]).sort(upgradeSorter)){if(a!==b.type){const c=humanize(Object.keys(UpgradeType)[b.type]);loadUpgrade({name:`- ${c}`},homeView.upgrades,!1),a=b.type}loadUpgrade(b,homeView.upgrades,!1)}}const statsList=id("stats-list");function onStatsPanel(){for(const a in statsList.innerText="",state.stats){const b=el("li"),c=state.stats[a];let d=c;switch(Stats[a]){case Stats.AVERAGE_RATIO:d=`${c.toFixed(2)}%`;break;case Stats.TOTAL_MONEY:d=`${c.toFixed(2)}€`;break;case Stats.SIZE_DL:d=formatFileSize(c);}b.innerText=`${Stats[a]}: ${d}`,statsList.append(b)}}function getStatKey(a){return Object.keys(Stats)[Object.values(Stats).indexOf(a)]}function addToStat(a,b){state.stats[getStatKey(a)]+=b}function setStat(a,b){state.stats[getStatKey(a)]=b}function getStat(a){return state.stats[getStatKey(a)]}function initStats(){for(const a in Stats)void 0===state.stats[a]&&(state.stats[a]=0)}const shopView={firstLoad:!0,shopRoot:id("shop-root"),bought:id("upgrades-bought")};function buyUpgrade(a){hasUpgrade(a.id)||(state.upgrades.push(a.id),state.money-=a.cost,updateMoney(),save(),refreshShop())}function loadUpgrade(a,b,c){const d=el("li"),e=hasUpgrade(a.id);let f,g=a.name;if(!c||void 0===a.cost)f=el("div"),f.innerText=g;else{f=el("a"),f.href="#",f.innerText=g,e?d.classList.add("disabled"):a.cost>state.money?f.classList.add("danger"):d.onclick=()=>buyUpgrade(a,d);const b=el("span");b.classList.add("li-right"),b.innerText=`${a.cost} €`,f.append(b)}if(a.desc||a.value){const b=el("span");b.classList.add("tooltip");let c=a.desc;switch(a.type){case UpgradeType.STORAGE:c=formatFileSize(a.value);break;case UpgradeType.CONNECTION:c=formatFileSize(a.value)+"/s";}b.innerText=c,f.append(b)}if(d.append(f),void 0!==a.children){const b=el("ul");a.children.forEach(a=>loadUpgrade(a,b,c)),d.append(b),d.classList.add("is-opened")}b.append(d)}function refreshShop(){shopView.shopRoot.innerText="",Upgrades.forEach(a=>loadUpgrade(a,shopView.shopRoot,!0))}function onShopPanel(){updateMoney(),refreshShop()}function updateMoney(){for(const a of document.getElementsByClassName("money"))a.innerText=state.money.toFixed(2)}let state;function getMaxStorageUpgrade(){const a=state.upgrades.map(a=>idToUpgrade[a]).filter(a=>a.type===UpgradeType.STORAGE);return a.reduce((a,b)=>b.value>a.value?b:a)}function getMaxInternetUpgrade(){const a=state.upgrades.map(a=>idToUpgrade[a]).filter(a=>a.type===UpgradeType.CONNECTION);return a.reduce((a,b)=>b.value>a.value?b:a)}function hasUpgrade(a){return state.upgrades.includes(a)}const idToUpgrade={};function initUpgrades(){function a(b){b.id!==void 0&&(idToUpgrade[b.id]=b),b.children&&b.children.forEach(a)}Upgrades.forEach(a)}function load(){let a=localStorage.getItem(LocalStorageKey);if(null===a)state={money:0,upgrades:[UpgradeID.STO_FLOPPY,UpgradeID.CON_MODEM],stats:{}};else try{state=JSON.parse(atob(a))}catch(b){alert("Your save is corrupted or invalid. It is going to be reset."),a=null,localStorage.removeItem(LocalStorageKey),state={money:0,upgrades:[UpgradeID.STO_FLOPPY,UpgradeID.CON_MODEM],stats:{}}}return initStats(),initUpgrades(),null!==a}function save(){localStorage.setItem(LocalStorageKey,btoa(JSON.stringify(state)))}function exportSave(){const a=localStorage.getItem(LocalStorageKey);null===a?alert("No save... yet!"):alert("Here is your save. Copy the whole string to import later or to backup.\n\n"+btoa(a))}function importSave(){const a=prompt("Enter your save string here. This will overwrite your current save!\nProceed with caution.");if(null!==a)try{localStorage.setItem(LocalStorageKey,atob(a)),location.reload()}catch(a){alert("The save you provided could not be decoded. Are you sure it is valid?")}}function clearSave(){confirm("You will not be able to undo this. Are you sure you want to continue?")&&(localStorage.removeItem(LocalStorageKey),location.reload())}function setupLinks(){const a=document.querySelectorAll("a[data-target-panel]");a.forEach(a=>{const b=a.getAttribute("data-target-panel");a.onclick=()=>{setPanel(Panels[b])}});const b=document.querySelectorAll("a[data-execute]");b.forEach(a=>{const b=a.getAttribute("data-execute"),c=window[b];"function"==typeof c?a.onclick=c:console.error("Invalid data-execute target: "+b)})}let currentPanel="";function setPanel(a){currentPanel=a;const b=document.querySelectorAll(".panel");b.forEach(b=>{b.style.display=b.id===a?"flex":"none"});const c=window[`on${humanize(a)}Panel`];"function"==typeof c&&c()}(function(){const a=load();setupLinks(),setPanel(a?Panels.HOME:Panels.MENU)})();